var W=Object.defineProperty,B=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var z=(i,e,t)=>e in i?W(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,m=(i,e)=>{for(var t in e||(e={}))F.call(e,t)&&z(i,t,e[t]);if(q)for(var t of q(e))N.call(e,t)&&z(i,t,e[t]);return i},D=(i,e)=>B(i,v(e));var d=(i,e,t)=>new Promise((r,s)=>{var l=o=>{try{a(t.next(o))}catch(c){s(c)}},n=o=>{try{a(t.throw(o))}catch(c){s(c)}},a=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,n);a((t=t.apply(i,e)).next())});const O="https://app.dataengineerhub.blog",H="".concat(O,"/wp-json/wp/v2");class X{constructor(){this.baseURL=H,this.cache=new Map,this.cacheTimeout=10*1e3,this.requestQueue=new Map}clearCache(e=null){if(e)for(const[t]of this.cache.entries())t.includes(e)&&this.cache.delete(t);else this.cache.clear()}makeRequest(r){return d(this,arguments,function*(e,t={}){const s="".concat(e,"_").concat(JSON.stringify(t)),l=this.cache.get(s);if(l&&Date.now()-l.timestamp<this.cacheTimeout)return l.data;try{const n=yield fetch("".concat(this.baseURL).concat(e),m({mode:"cors",headers:m({"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},t.headers),signal:AbortSignal.timeout(15e3)},t));if(!n.ok){const g=yield n.text();throw new Error("HTTP ".concat(n.status,": ").concat(g))}const a=yield n.json(),o=parseInt(n.headers.get("X-WP-Total")||"0"),c=parseInt(n.headers.get("X-WP-TotalPages")||"1"),u={data:a,totalPosts:o,totalPages:c,timestamp:Date.now()};return this.cache.set(s,u),u}catch(n){throw n}})}getPosts(){return d(this,arguments,function*({page:e=1,per_page:t=10,categoryId:r=null,search:s=null,featured:l=null,trending:n=null}={}){const a=new URLSearchParams({page:e.toString(),per_page:t.toString(),_embed:"true",status:"publish"});r&&a.append("categories",r.toString()),s&&a.append("search",s),l&&(a.append("meta_key","featured"),a.append("meta_value","1")),n&&(a.append("meta_key","trending"),a.append("meta_value","1"));const o=yield this.makeRequest("/posts?".concat(a.toString())),c=o.data;return Array.isArray(c)?{posts:this.transformPosts(c),totalPages:o.totalPages,totalPosts:o.totalPosts}:{posts:[],totalPages:1,totalPosts:0}})}getCategories(){return d(this,null,function*(){const t=(yield this.makeRequest("/categories?per_page=100&hide_empty=false")).data;return Array.isArray(t)?t.map(r=>({id:r.id,name:r.name,slug:r.slug,count:r.count||0,description:r.description||""})):[]})}getCategoryIdBySlug(e){return d(this,null,function*(){const r=(yield this.getCategories()).find(s=>s.slug.toLowerCase()===e.toLowerCase()||s.name.toLowerCase()===e.toLowerCase());if(r)return r.id;throw new Error('Category "'.concat(e,'" not found'))})}getPostsByCategory(r){return d(this,arguments,function*(e,t={}){return this.getPosts(D(m({},t),{categoryId:e}))})}getPostBySlug(e){return d(this,null,function*(){const r=(yield this.makeRequest("/posts?slug=".concat(e,"&_embed=true"))).data;if(!Array.isArray(r)||r.length===0)throw new Error('Post with slug "'.concat(e,'" not found'));return this.transformPost(r[0])})}transformPost(e){var u,g,h,p,f,_,y,w,C,P,b,A,R,$,x,S,T,k,E,L,U,I,j;const t=(g=(u=e._embedded)==null?void 0:u["wp:featuredmedia"])==null?void 0:g[0];let r="https://images.unsplash.com/photo-1595872018818-97555653a011?w=800&h=600&fit=crop";t?(f=(p=(h=t.media_details)==null?void 0:h.sizes)==null?void 0:p.large)!=null&&f.source_url?r=t.media_details.sizes.large.source_url:(w=(y=(_=t.media_details)==null?void 0:_.sizes)==null?void 0:y.medium_large)!=null&&w.source_url?r=t.media_details.sizes.medium_large.source_url:t.source_url&&(r=t.source_url):e.jetpack_featured_media_url&&(r=e.jetpack_featured_media_url);const s=((P=(C=e._embedded)==null?void 0:C["wp:term"])==null?void 0:P[0])||[],l=((b=s.find(M=>M.name!=="Uncategorized"))==null?void 0:b.name)||((A=s[0])==null?void 0:A.name)||"Uncategorized",n=((x=($=(R=e._embedded)==null?void 0:R.author)==null?void 0:$[0])==null?void 0:x.name)||"DataEngineer Hub",a=((S=e.meta)==null?void 0:S.featured)==="1"||((T=e.meta)==null?void 0:T.featured)===1,o=((k=e.meta)==null?void 0:k.trending)==="1"||((E=e.meta)==null?void 0:E.trending)===1,c=(L=e.excerpt)!=null&&L.rendered?this.cleanExcerpt(e.excerpt.rendered):"";return{id:e.id,slug:e.slug,title:((U=e.title)==null?void 0:U.rendered)||"Untitled",excerpt:c,content:((I=e.content)==null?void 0:I.rendered)||"",category:l,readTime:this.calculateReadTime(((j=e.content)==null?void 0:j.rendered)||""),date:e.date,image:r,featured:a,trending:o,author:n}}transformPosts(e){return e.map(t=>this.transformPost(t))}cleanExcerpt(e){return e.replace(/<[^>]*>/g,"").replace(/\[&hellip;\]/g,"...").trim()}calculateReadTime(e){const s=e.replace(/<[^>]*>/g,"").split(/\s+/).length;return"".concat(Math.ceil(s/200)," min read")}subscribeNewsletter(e){return d(this,null,function*(){return{success:!0}})}submitContactForm(e){return d(this,null,function*(){return{success:!0}})}}const K=new X;export{K as w};
