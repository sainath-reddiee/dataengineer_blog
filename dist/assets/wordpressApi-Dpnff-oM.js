const e="https://app.dataengineerhub.blog",t=`${e}/wp-json/wp/v2`;const a=new class{constructor(){this.baseURL=t,this.cache=new Map,this.cacheTimeout=1e4,this.requestQueue=new Map}clearCache(e=null){if(e)for(const[t]of this.cache.entries())t.includes(e)&&this.cache.delete(t);else this.cache.clear()}async makeRequest(e,t={}){const a=`${e}_${JSON.stringify(t)}`,r=this.cache.get(a);if(r&&Date.now()-r.timestamp<this.cacheTimeout)return r.data;try{const r=await fetch(`${this.baseURL}${e}`,{mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache",...t.headers},signal:AbortSignal.timeout(15e3),...t});if(!r.ok){const e=await r.text();throw new Error(`HTTP ${r.status}: ${e}`)}const s=await r.json(),n=parseInt(r.headers.get("X-WP-Total")||"0"),o={data:s,totalPosts:n,totalPages:parseInt(r.headers.get("X-WP-TotalPages")||"1"),timestamp:Date.now()};return this.cache.set(a,o),o}catch(s){throw s}}async getPosts({page:e=1,per_page:t=10,categoryId:a=null,search:r=null,featured:s=null,trending:n=null}={}){const o=new URLSearchParams({page:e.toString(),per_page:t.toString(),_embed:"true",status:"publish"});a&&o.append("categories",a.toString()),r&&o.append("search",r),s&&(o.append("meta_key","featured"),o.append("meta_value","1")),n&&(o.append("meta_key","trending"),o.append("meta_value","1"));const i=await this.makeRequest(`/posts?${o.toString()}`),l=i.data;if(!Array.isArray(l))return{posts:[],totalPages:1,totalPosts:0};return{posts:this.transformPosts(l),totalPages:i.totalPages,totalPosts:i.totalPosts}}async getCategories(){const e=(await this.makeRequest("/categories?per_page=100&hide_empty=false")).data;return Array.isArray(e)?e.map(e=>({id:e.id,name:e.name,slug:e.slug,count:e.count||0,description:e.description||""})):[]}async getCategoryIdBySlug(e){const t=(await this.getCategories()).find(t=>t.slug.toLowerCase()===e.toLowerCase()||t.name.toLowerCase()===e.toLowerCase());if(t)return t.id;throw new Error(`Category "${e}" not found`)}async getPostsByCategory(e,t={}){return this.getPosts({...t,categoryId:e})}async getPostBySlug(e){const t=(await this.makeRequest(`/posts?slug=${e}&_embed=true`)).data;if(!Array.isArray(t)||0===t.length)throw new Error(`Post with slug "${e}" not found`);return this.transformPost(t[0])}transformPost(e){var t,a,r,s,n,o,i,l,d,u,c,g,p,m,h,_,w,f,v,y,P,C,b;const $=null==(a=null==(t=e._embedded)?void 0:t["wp:featuredmedia"])?void 0:a[0];let T="https://images.unsplash.com/photo-1595872018818-97555653a011?w=800&h=600&fit=crop";$?(null==(n=null==(s=null==(r=$.media_details)?void 0:r.sizes)?void 0:s.large)?void 0:n.source_url)?T=$.media_details.sizes.large.source_url:(null==(l=null==(i=null==(o=$.media_details)?void 0:o.sizes)?void 0:i.medium_large)?void 0:l.source_url)?T=$.media_details.sizes.medium_large.source_url:$.source_url&&(T=$.source_url):e.jetpack_featured_media_url&&(T=e.jetpack_featured_media_url);const k=(null==(u=null==(d=e._embedded)?void 0:d["wp:term"])?void 0:u[0])||[],R=(null==(c=k.find(e=>"Uncategorized"!==e.name))?void 0:c.name)||(null==(g=k[0])?void 0:g.name)||"Uncategorized",S=(null==(h=null==(m=null==(p=e._embedded)?void 0:p.author)?void 0:m[0])?void 0:h.name)||"DataEngineer Hub",A="1"===(null==(_=e.meta)?void 0:_.featured)||1===(null==(w=e.meta)?void 0:w.featured),x="1"===(null==(f=e.meta)?void 0:f.trending)||1===(null==(v=e.meta)?void 0:v.trending),L=(null==(y=e.excerpt)?void 0:y.rendered)?this.cleanExcerpt(e.excerpt.rendered):"";return{id:e.id,slug:e.slug,title:(null==(P=e.title)?void 0:P.rendered)||"Untitled",excerpt:L,content:(null==(C=e.content)?void 0:C.rendered)||"",category:R,readTime:this.calculateReadTime((null==(b=e.content)?void 0:b.rendered)||""),date:e.date,image:T,featured:A,trending:x,author:S}}transformPosts(e){return e.map(e=>this.transformPost(e))}cleanExcerpt(e){return e.replace(/<[^>]*>/g,"").replace(/\[&hellip;\]/g,"...").trim()}calculateReadTime(e){const t=e.replace(/<[^>]*>/g,"").split(/\s+/).length;return`${Math.ceil(t/200)} min read`}};export{e as W,a as w};
